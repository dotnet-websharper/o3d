var o3d=o3d||{};var goog=goog||{};goog.typedef=true;o3d.global=this;o3d.basePath='';if(!Object.prototype.__defineSetter__){Object.prototype.__defineSetter__=function(){}
Object.prototype.__defineGetter__=function(){}}
o3d.findBasePath_=function(){var doc=o3d.global.document;if(typeof doc=='undefined'){return;}
if(o3d.global.BASE_PATH){o3d.basePath=o3d.global.BASE_PATH;return;}else{o3d.global.BASE_PATH=null;}
var scripts=doc.getElementsByTagName('script');for(var script,i=0;script=scripts[i];i++){var src=script.src;var l=src.length;var s='o3d-webgl/base.js';var sl=s.length;if(src.substr(l-sl)==s){o3d.basePath=src.substr(0,l-sl)+'o3d-webgl/';return;}}};o3d.writeScriptTag_=function(src){var doc=o3d.global.document;if(typeof doc!='undefined'){doc.write('<script type="text/javascript" src="'+
src+'"></'+'script>');}};o3d.filterTypeName_=function(type_name){if(type_name.length>=4&&type_name.substr(0,4)=='o3d.'){type_name=type_name.substr(4);}
return type_name;};o3d.include=function(rule){var parts=rule.split('.');var path=parts[parts.length-1]+'.js';o3d.writeScriptTag_(o3d.basePath+path);};o3d.inherit=function(subClassName,superClassName){var superClass=o3d.global.o3d[superClassName];var subClass=o3d.global.o3d[subClassName];if(!superClass)
throw('Invalid superclass: '+superClassName);if(!subClass)
throw('Invalid subclass: '+subClassName);subClass.prototype=new superClass;subClass.prototype.superClassName=superClassName;subClass.prototype.superClass=superClass;subClass.prototype.className=subClassName;};o3d.removeFromArray=function(array,object){var i=array.indexOf(object);if(i>=0){array.splice(i,1);}};o3d.isArray_=function(value){var valueAsObject=(value);return typeof(value)==='object'&&value!==null&&'length'in valueAsObject&&'splice'in valueAsObject;};o3d.clone=function(object){var result=o3d.isArray_(object)?[]:{};for(var name in object){var property=object[name];if(typeof property=='Object'){result[name]=o3d.clone(property);}else{result[name]=property;}}
return result;};o3d.notImplemented=function(){debugger;throw'Not implemented.';};o3d.findBasePath_();o3d.ObjectBase=function(){};o3d.ObjectBase.prototype.className='o3d.ObjectBase';o3d.ObjectBase.prototype.superClass=null;o3d.ObjectBase.prototype.isAClassName=function(class_type_name){class_type_name=o3d.filterTypeName_(class_type_name);var object=this;while(object!=undefined){if(object.className==class_type_name){return true;}
object=object.superClass&&object.superClass.prototype;}
return false;};o3d.NamedObjectBase=function(){o3d.ObjectBase.call(this);};o3d.inherit('NamedObjectBase','ObjectBase');o3d.NamedObjectBase.prototype.name="";o3d.NamedObject=function(){o3d.NamedObjectBase.call(this);};o3d.inherit('NamedObject','NamedObjectBase');o3d.NamedObject.prototype.name='';o3d.ParamObject=function(){o3d.NamedObject.call(this);this.params_={};};o3d.inherit('ParamObject','NamedObject');o3d.ParamObject.prototype.__defineGetter__('params',function(){var paramList=[];for(name in this.params_){paramList.push(this.params_[name]);}
return paramList;});o3d.ParamObject.prototype.__defineSetter__('params',function(){});o3d.ParamObject.O3D_PREFIX_='o3d.';o3d.ParamObject.prototype.createParam=function(param_name,param_type_name){if(this.params_[param_name])
return null;param_type_name=o3d.filterTypeName_(param_type_name);if(!o3d.global.o3d[param_type_name])
throw('Invalid param type name: '+param_type_name);var param=new o3d.global.o3d[param_type_name];param.gl=this.gl;param.owner_=this;param.name=param_name;this.params_[param_name]=param;return this.filterResult_(this.params_[param_name]);};o3d.ParamObject.prototype.getParam=function(param_name){var result=this.params_[param_name];var o3d_name;if(!result){o3d_name=o3d.ParamObject.O3D_PREFIX_+param_name;result=this.params_[o3d_name];}
if(!result){var lazyParamMap=this.lazyParamMap_;if(lazyParamMap){var name=param_name;var param_type=this.lazyParamMap_[name];if(!param_type){name=o3d_name;param_type=this.lazyParamMap_[name];}
if(param_type){result=this.createParam(name,param_type);}}}
return this.filterResult_(result);};o3d.ParamObject.prototype.removeParam=function(param){for(var i in this.params_){if(this.params_[i]==param){delete this.params_[i];}}};o3d.ParamObject.prototype.params_={};o3d.ParamObject.prototype.copyParams=function(source_param_object){for(name in source_param_object.params_){var param=source_param_object.params_[name];this.createParam(name,param.className);this.getParam(name).value=param.value;}};o3d.ParamObject.prototype.filterResult_=function(result){return(result?result:null);};o3d.ParamObject.setUpO3DParam_=function(constructor,fieldName,paramType){var o3dParamName=o3d.ParamObject.O3D_PREFIX_+fieldName;var lazyParamMap=constructor.prototype.lazyParamMap_;if(!lazyParamMap){lazyParamMap={};constructor.prototype.lazyParamMap_=lazyParamMap;}
lazyParamMap[o3dParamName]=paramType;constructor.prototype.__defineGetter__(fieldName,function(){var param=this.getParam(o3dParamName);return param.value;});constructor.prototype.__defineSetter__(fieldName,function(v){var param=this.getParam(o3dParamName);param.value=v;});};o3d.ParamArray=function(){o3d.NamedObject.call(this);this.params_=[];};o3d.inherit('ParamArray','NamedObject');o3d.ParamArray.prototype.createParam=function(index,param_type_name){param_type_name=o3d.filterTypeName_(param_type_name);if(!o3d.global.o3d[param_type_name])
throw('Invalid param type name: '+param_type_name);if(index>=this.params_.length){this.resize(index+1,param_type_name);}else{var param=new o3d.global.o3d[param_type_name];param.gl=this.gl;param.owner_=this;this.params_[index]=param;}
return this.filterResult_(this.params_[index]);};o3d.ParamArray.prototype.getParam=function(index){var result=this.params_[index];return this.filterResult_(result);};o3d.ParamArray.prototype.removeParams=function(start_index,num_to_remove){var paramsNew=[];var j=0;for(var i=0;i<this.params_.length;i++){if(i>=start_index&&i<start_index+num_to_remove){}else{paramsNew[j]=this.params_[i];j++;}}
this.params_=paramsNew;};o3d.ParamArray.prototype.resize=function(num_params,param_type_name){param_type_name=o3d.filterTypeName_(param_type_name);if(!o3d.global.o3d[param_type_name])
throw('Invalid param type name: '+param_type_name);for(var i=this.params_.length;i<num_params;i++){var param=new o3d.global.o3d[param_type_name];param.gl=this.gl;param.owner_=this;this.params_[i]=param;}};o3d.ParamArray.prototype.params_=[];o3d.ParamArray.prototype.__defineGetter__('params',function(){var params=[];for(var i=0;i<this.length;i++){params[i]=this.params_[i];}
return params;});o3d.ParamArray.prototype.__defineGetter__('length',function(){return this.params_.length;});o3d.ParamArray.prototype.filterResult_=function(result){return(result?result:null);};o3d.Param=function(param_type_name){o3d.Param.prototype.output_connections=[];this.outputConnections=[];}
o3d.inherit('Param','NamedObject');o3d.Param.prototype.update_input=true;o3d.Param.prototype.inputConnection=null;o3d.Param.prototype.outputConnections=[];o3d.Param.prototype.owner_=null;o3d.Param.prototype.value_=null;o3d.Param.prototype.__defineSetter__('value',function(v){if(this.inputConnection){throw('Tried to set bound parameter.');}else{if(this.value_!=undefined&&(typeof this.value_!=typeof v||(this.value_.length_!==undefined&&(this.value_.length_!=v.length)))){this.gl.client.error_callback('Param type error.');}
this.value_=v;}});o3d.Param.prototype.__defineGetter__('value',function(){if(this.inputConnection){return this.inputConnection.value;}else{return this.value_;}});o3d.Param.prototype.bind=function(source_param){source_param.outputConnections.push(this);this.inputConnection=source_param;};o3d.Param.prototype.unbindInput=function(){o3d.notImplemented();};o3d.Param.prototype.unbindOutput=function(destination_param){o3d.notImplemented();};o3d.Param.prototype.unbindOutputs=function(){o3d.notImplemented();};o3d.Param.prototype.read_only_=false;o3d.ParamBoolean=function(){o3d.Param.call(this);this.value=false;};o3d.inherit('ParamBoolean','Param');o3d.ParamBoundingBox=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamBoundingBox','Param');o3d.ParamBoundingBox.prototype.__defineSetter__('value',function(v){if(this.inputConnection){throw('Tried to set bound parameter.');}else{if(!v){v=new o3d.BoundingBox();}else if(v.length!==undefined){if(v.length==0){v=new o3d.BoundingBox();}else if(v.length==2){for(var ii=0;ii<2;++ii){if(v[ii].length!=3){throw('Expected sub-array of length 3 at index '+ii+', got '+v[ii].length);}}
v=new o3d.BoundingBox(v[0],v[1]);}else{throw'Expected array of length 2';}}
this.value_=v;}});o3d.ParamBoundingBox.prototype.__defineGetter__('value',function(){if(this.inputConnection){return this.inputConnection.value;}else{return this.value_;}});o3d.ParamDrawContext=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamDrawContext','Param');o3d.ParamDrawList=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamDrawList','Param');o3d.ParamEffect=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamEffect','Param');o3d.ParamFloat=function(){o3d.Param.call(this);this.value=0.0;};o3d.inherit('ParamFloat','Param');o3d.ParamFloat2=function(){o3d.Param.call(this);this.value=[0.0,0.0];};o3d.inherit('ParamFloat2','Param');o3d.ParamFloat3=function(){o3d.Param.call(this);this.value=[0.0,0.0,0.0];};o3d.inherit('ParamFloat3','Param');o3d.ParamFloat4=function(){o3d.Param.call(this);this.value=[0.0,0.0,0.0,0.0];};o3d.inherit('ParamFloat4','Param');o3d.ParamFunction=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamFunction','Param');o3d.ParamInteger=function(){o3d.Param.call(this);this.value=0;};o3d.inherit('ParamInteger','Param');o3d.ParamMaterial=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamMaterial','Param');o3d.ParamMatrix4=function(){o3d.Param.call(this);this.value=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];};o3d.inherit('ParamMatrix4','Param');o3d.ParamParamArray=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamParamArray','Param');o3d.ParamParamArrayOutput=function(){o3d.ParamParamArray.call(this);};o3d.inherit('ParamParamArrayOutput','ParamParamArray');o3d.ParamParamArrayOutput.prototype.__defineGetter__("value",function(){this.owner_.updateOutputs(this);return this.value_;});o3d.ParamParamArrayOutput.prototype.__defineSetter__("value",function(value){this.value_=value;});o3d.ParamRenderSurface=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamRenderSurface','Param');o3d.ParamRenderDepthStencilSurface=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamRenderDepthStencilSurface','Param');o3d.ParamSampler=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamSampler','Param');o3d.ParamSkin=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamSkin','Param');o3d.ParamSteamBank=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamSteamBank','Param');o3d.ParamState=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamState','Param');o3d.ParamStreamBank=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamStreamBank','Param');o3d.ParamString=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamString','Param');o3d.ParamTexture=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamTexture','Param');o3d.ParamTransform=function(){o3d.Param.call(this);this.value=null;};o3d.inherit('ParamTransform','Param');o3d.ParamVertexBufferStream=function(){o3d.Param.call(this);this.stream=null;};o3d.inherit('ParamVertexBufferStream','Param');o3d.CompositionParamMatrix4=function(){o3d.ParamMatrix4.call(this);this.matrix_names_=[];};o3d.inherit('CompositionParamMatrix4','ParamMatrix4');o3d.CompositionParamMatrix4.prototype.matrix_names_=[];o3d.CompositionParamMatrix4.prototype.inverse_=false;o3d.CompositionParamMatrix4.prototype.transpose_=false;o3d.CompositionParamMatrix4.prototype.__defineGetter__('value',function(){var product=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(var i=0;i<this.matrix_names_.length;++i){o3d.Transform.compose(product,o3d.Param.SAS[this.matrix_names_[i]]);}
if(this.inverse_){o3d.Transform.inverse(product);}
if(this.transpose_){o3d.Transform.transpose(product);}
return product;});o3d.CompositionParamMatrix4.prototype.__defineSetter__('value',function(value){});o3d.ProjectionParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['projection'];};o3d.inherit('ProjectionParamMatrix4','CompositionParamMatrix4');o3d.ProjectionInverseParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['projection'];this.inverse_=true;};o3d.inherit('ProjectionInverseParamMatrix4','CompositionParamMatrix4');o3d.ProjectionTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['projection'];this.transpose_=true;};o3d.inherit('ProjectionTransposeParamMatrix4','CompositionParamMatrix4');o3d.ProjectionInverseTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['projection'];this.inverse_=true;this.transpose_=true;};o3d.inherit('ProjectionInverseTransposeParamMatrix4','CompositionParamMatrix4');o3d.ViewParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view'];};o3d.inherit('ViewParamMatrix4','CompositionParamMatrix4');o3d.ViewInverseParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view'];this.inverse_=true;};o3d.inherit('ViewInverseParamMatrix4','CompositionParamMatrix4');o3d.ViewTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view'];this.transpose_=true;};o3d.inherit('ViewTransposeParamMatrix4','CompositionParamMatrix4');o3d.ViewInverseTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view'];this.inverse_=true;this.transpose_=true;};o3d.inherit('ViewInverseTransposeParamMatrix4','CompositionParamMatrix4');o3d.ViewProjectionParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['viewProjection'];};o3d.inherit('ViewProjectionParamMatrix4','CompositionParamMatrix4');o3d.ViewProjectionInverseParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['viewProjection'];this.inverse_=true;};o3d.inherit('ViewProjectionInverseParamMatrix4','CompositionParamMatrix4');o3d.ViewProjectionTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['viewProjection'];this.transpose_=true;};o3d.inherit('ViewProjectionTransposeParamMatrix4','CompositionParamMatrix4');o3d.ViewProjectionInverseTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['viewProjection'];this.inverse_=true;this.transpose_=true;};o3d.inherit('ViewProjectionInverseTransposeParamMatrix4','CompositionParamMatrix4');o3d.WorldParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['world'];};o3d.inherit('WorldParamMatrix4','CompositionParamMatrix4');o3d.WorldInverseParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['world'];this.inverse_=true;};o3d.inherit('WorldInverseParamMatrix4','CompositionParamMatrix4');o3d.WorldTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['world'];this.transpose_=true;};o3d.inherit('WorldTransposeParamMatrix4','CompositionParamMatrix4');o3d.WorldInverseTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['world'];this.inverse_=true;this.transpose_=true;};o3d.inherit('WorldInverseTransposeParamMatrix4','CompositionParamMatrix4');o3d.WorldViewParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view','world'];};o3d.inherit('WorldViewParamMatrix4','CompositionParamMatrix4');o3d.WorldViewInverseParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view','world'];this.inverse_=true;};o3d.inherit('WorldViewInverseParamMatrix4','CompositionParamMatrix4');o3d.WorldViewTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view','world'];this.transpose_=true;};o3d.inherit('WorldViewTransposeParamMatrix4','CompositionParamMatrix4');o3d.WorldViewInverseTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['view','world'];this.inverse_=true;this.transpose_=true;};o3d.inherit('WorldViewInverseTransposeParamMatrix4','CompositionParamMatrix4');o3d.WorldViewProjectionParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['worldViewProjection'];};o3d.inherit('WorldViewProjectionParamMatrix4','CompositionParamMatrix4');o3d.WorldViewProjectionInverseParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['worldViewProjection'];this.inverse_=true;};o3d.inherit('WorldViewProjectionInverseParamMatrix4','CompositionParamMatrix4');o3d.WorldViewProjectionTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['worldViewProjection'];this.transpose_=true;};o3d.inherit('WorldViewProjectionTransposeParamMatrix4','CompositionParamMatrix4');o3d.WorldViewProjectionInverseTransposeParamMatrix4=function(){o3d.CompositionParamMatrix4.call(this);this.matrix_names_=['worldViewProjection'];this.inverse_=true;this.transpose_=true;};o3d.inherit('WorldViewProjectionInverseTransposeParamMatrix4','CompositionParamMatrix4');o3d.ParamInteger.prototype.applyToLocation=function(gl,location){gl.uniform1i(location,this.value);};o3d.ParamBoolean.prototype.applyToLocation=function(gl,location){gl.uniform1i(location,this.value);};o3d.ParamFloat.prototype.applyToLocation=function(gl,location){gl.uniform1f(location,this.value);};o3d.ParamFloat2.prototype.applyToLocation=function(gl,location){gl.uniform2fv(location,this.value);};o3d.ParamFloat3.prototype.applyToLocation=function(gl,location){gl.uniform3fv(location,this.value);};o3d.ParamFloat4.prototype.applyToLocation=function(gl,location){gl.uniform4fv(location,this.value);};o3d.ParamMatrix4.prototype.applyToLocation=function(gl,location){gl.uniformMatrix4fv(location,false,o3d.Transform.flattenMatrix4(this.value));};o3d.ParamParamArray.prototype.applyToLocations=function(gl,locationArray){var computedValue=this.value;if(locationArray.length!=computedValue.length){gl.client.error_callback('Invalid uniform param array: incorrect number of elements.');}
for(var i=0;i<computedValue.length;i++){computedValue.getParam(i).applyToLocation(gl,locationArray[i]);}};o3d.Param.texture_index_=0;o3d.ParamSampler.prototype.applyToLocation=function(gl,location,opt_isCube){var i=o3d.Param.texture_index_;gl.activeTexture(gl.TEXTURE0+i);var value=null;var target=0;var sampler=null;if(this.value){sampler=this.value;}else{o3d.Sampler.defaultSampler_.gl=gl;sampler=o3d.Sampler.defaultSampler_;if(gl.client.reportErrors_()){gl.client.error_callback("Missing Sampler for ParamSampler "+this.name);}}
sampler.bindAndSetParameters_(opt_isCube);gl.uniform1i(location,i);o3d.Param.texture_index_++;};o3d.ParamSampler.defaultParamSampler_=new o3d.ParamSampler();o3d.Param.SAS=new o3d.ParamObject;o3d.Param.sasTypes_={'world':'WorldParamMatrix4','view':'ViewParamMatrix4','projection':'ProjectionParamMatrix4','worldView':'WorldViewParamMatrix4','viewProjection':'ViewProjectionParamMatrix4','worldViewProjection':'WorldViewProjectionParamMatrix4','worldInverse':'WorldInverseParamMatrix4','viewInverse':'ViewInverseParamMatrix4','projectionInverse':'ProjectionInverseParamMatrix4','worldViewInverse':'WorldViewInverseParamMatrix4','viewProjectionInverse':'ViewProjectionInverseParamMatrix4','worldViewProjectionInverse':'WorldViewProjectionInverseParamMatrix4','worldTranspose':'WorldTransposeParamMatrix4','viewTranspose':'ViewTransposeParamMatrix4','projectionTranspose':'ProjectionTransposeParamMatrix4','worldViewTranspose':'WorldViewTransposeParamMatrix4','viewProjectionTranspose':'ViewProjectionTransposeParamMatrix4','worldViewProjectionTranspose':'WorldViewProjectionTransposeParamMatrix4','worldInverseTranspose':'WorldInverseTransposeParamMatrix4','viewInverseTranspose':'ViewInverseTransposeParamMatrix4','projectionInverseTranspose':'ProjectionInverseTransposeParamMatrix4','worldViewInverseTranspose':'WorldViewInverseTransposeParamMatrix4','viewProjectionInverseTranspose':'ViewProjectionInverseTransposeParamMatrix4','worldViewProjectionInverseTranspose':'WorldViewProjectionInverseTransposeParamMatrix4'};for(name in o3d.Param.sasTypes_){o3d.Param.SAS.createParam(name,o3d.Param.sasTypes_[name]);}
o3d.Param.SAS.setWorld=function(world){this['world']=world;};o3d.Param.SAS.setView=function(view){this['view']=view;};o3d.Param.SAS.setProjection=function(projection){this['projection']=projection;};o3d.Param.SAS.setViewProjection=function(viewProjection){this['viewProjection']=viewProjection;};o3d.Param.SAS.setWorldViewProjection=function(worldViewProjection){this['worldViewProjection']=worldViewProjection;};o3d.Event=function(){o3d.ObjectBase.call(this);};o3d.inherit('Event','ObjectBase');o3d.Event.Type=goog.typedef;o3d.Event.TYPE_INVALID=0;o3d.Event.TYPE_CLICK=1;o3d.Event.TYPE_DBLCLICK=2;o3d.Event.TYPE_MOUSEDOWN=3;o3d.Event.TYPE_MOUSEMOVE=4;o3d.Event.TYPE_MOUSEUP=5;o3d.Event.TYPE_WHEEL=6;o3d.Event.TYPE_KEYDOWN=7;o3d.Event.TYPE_KEYPRESS=8;o3d.Event.TYPE_KEYUP=9;o3d.Event.TYPE_RESIZE=10;o3d.Event.prototype.type=o3d.Event.TYPE_INVALID;o3d.Event.Button=goog.typedef;o3d.Event.BUTTON_LEFT=0;o3d.Event.BUTTON_MIDDLE=1;o3d.Event.BUTTON_RIGHT=2;o3d.Event.BUTTON_4=3;o3d.Event.BUTTON_5=4;o3d.Event.prototype.button=o3d.Event.BUTTON_LEFT;o3d.Event.prototype.ctrl_key=false;o3d.Event.prototype.alt_key=false;o3d.Event.prototype.shift_key=false;o3d.Event.prototype.meta_key=false;o3d.Event.prototype.key_code=0;o3d.Event.prototype.char_code=0;o3d.Event.prototype.x=0;o3d.Event.prototype.y=0;o3d.Event.prototype.screenX=0;o3d.Event.prototype.screenY=0;o3d.Event.prototype.deltaX=0;o3d.Event.prototype.deltaY=0;o3d.Event.prototype.width=0;o3d.Event.prototype.height=0;o3d.Event.prototype.fullscreen=false;o3d.RenderEvent=function(){o3d.Event.call(this);};o3d.inherit('RenderEvent','Event');o3d.RenderEvent.prototype.elapsedTime=0;o3d.TickEvent=function(){o3d.Event.call(this);};o3d.inherit('RenderEvent','Event');o3d.TickEvent.prototype.elapsedTime=0;o3d.RawData=function(){o3d.NamedObject.call(this);};o3d.inherit('RawData','NamedObject');o3d.RawData.prototype.stringValue='';o3d.RawData.prototype.image_=null;o3d.RawData.prototype.uri='';o3d.RawData.prototype.length=0;o3d.RawData.prototype.discard=function(){o3d.notImplemented();};o3d.RawData.prototype.flush=function(){o3d.notImplemented();};o3d.Texture=function(){o3d.ParamObject.call(this);this.format=o3d.Texture.UNKNOWN_FORMAT;this.levels=1;this.alphaIsOne=true;this.texture_=null;this.texture_target_=0;this.texture_width_=0;this.texture_height_=0;this.parameter_cache_={};};o3d.inherit('Texture','ParamObject');o3d.Texture.Format=goog.typedef;o3d.Texture.UNKNOWN_FORMAT=0;o3d.Texture.XRGB8=1;o3d.Texture.ARGB8=2;o3d.Texture.ABGR16F=3;o3d.Texture.R32F=4;o3d.Texture.ABGR32F=5;o3d.Texture.DXT1=6;o3d.Texture.DXT3=7;o3d.Texture.DXT5=8;o3d.Texture.prototype.generateMips=function(source_level,num_levels){this.gl.bindTexture(this.texture_target_,this.texture_);this.gl.generateMipmap(this.texture_target_);this.levels=num_levels;};o3d.Texture.isPowerOfTwo_=function(value){return(value&(value-1))==0;};o3d.Texture.nextHighestPowerOfTwo_=function(value){var r=1;while(r<value){r*=2;}
return r;};o3d.Texture.prototype.getGLTextureFormat_=function(){switch(this.format){case o3d.Texture.XRGB8:return this.gl.RGB;case o3d.Texture.ARGB8:case o3d.Texture.ABGR16F:case o3d.Texture.ABGR32F:return this.gl.RGBA;case o3d.Texture.R32F:case o3d.Texture.DXT1:case o3d.Texture.DXT3:case o3d.Texture.DXT5:default:o3d.notImplemented();return 0;}}
o3d.Texture.prototype.getTexImage2DTarget_=function(opt_face){if(this.texture_target_==this.gl.TEXTURE_CUBE_MAP){return this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+opt_face;}else{return this.gl.TEXTURE_2D;}};o3d.Texture.maxLevels_=function(width,height){if(width==0||height==0){return 0;}
var max=Math.max(width,height);var levels=0;while(max>0){++levels;max=max>>1;}
return levels;};var g_counter=0;o3d.Texture.prototype.setFromCanvas_=function(canvas,resize_to_pot,flip,generate_mips,opt_face){var gl=this.gl;if(resize_to_pot&&(!o3d.Texture.isPowerOfTwo_(canvas.width)||!o3d.Texture.isPowerOfTwo_(canvas.height))){var scratch=o3d.Bitmap.getScratchCanvas_();scratch.width=o3d.Texture.nextHighestPowerOfTwo_(canvas.width);scratch.height=o3d.Texture.nextHighestPowerOfTwo_(canvas.height);scratch.getContext("2d").drawImage(canvas,0,0,canvas.width,canvas.height,0,0,scratch.width,scratch.height);canvas=scratch;}
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flip);gl.bindTexture(this.texture_target_,this.texture_);gl.texImage2D(this.getTexImage2DTarget_(opt_face),0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,canvas);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,0);this.texture_width_=canvas.width;this.texture_height_=canvas.height;if(generate_mips){this.gl.generateMipmap(this.texture_target_);this.levels=o3d.Texture.maxLevels_(this.texture_width_,this.texture_height_);}
g_counter++;};o3d.Texture.prototype.drawImageFromCanvas_=function(source_canvas,source_x,source_y,source_width,source_height,dest_mip,dest_x,dest_y,dest_width,dest_height,opt_face){var canvas=o3d.Bitmap.getScratchCanvas_();canvas.width=dest_width;canvas.height=dest_height;var context=canvas.getContext('2d');context.save();context.translate(-source_x,-source_y);context.scale(dest_width/source_width,dest_height/source_height);context.drawImage(source_canvas,0,0,source_canvas.width,source_canvas.height);var gl=this.gl;gl.bindTexture(this.texture_target_,this.texture_);var format=this.getGLTextureFormat_();gl.texImage2D(this.getTexImage2DTarget_(opt_face),dest_mip,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,canvas);this.texture_width_=canvas.width;this.texture_height_=canvas.height;context.restore();};o3d.Texture.prototype.setValues_=function(level,values,opt_face){var pixels=new Uint8Array(values.length);for(var i=0;i<values.length;++i){pixels[i]=Math.min(255,Math.max(0,values[i]*256.0));}
var format=this.getGLTextureFormat_();this.gl.bindTexture(this.texture_target_,this.texture_);this.gl.texSubImage2D(this.getTexImage2DTarget_(opt_face),level,0,0,this.texture_width_,this.texture_height_,format,this.gl.UNSIGNED_BYTE,pixels);};o3d.Texture.prototype.initWithTarget_=function(texture_target,width,height,format,levels,enable_render_surfaces,debug){this.width=width;this.height=height;this.format=format;this.levels=levels;this.texture_=this.gl.createTexture();this.texture_target_=texture_target;if(width!=undefined&&height!=undefined){this.gl.bindTexture(this.texture_target_,this.texture_);var format=this.getGLTextureFormat_();var pixels=new Uint8Array(width*height*4);var canvas=o3d.Bitmap.getScratchCanvas_();canvas.width=width;canvas.height=height;var numFaces=1;if(this.texture_target_==this.gl.TEXTURE_CUBE_MAP){numFaces=6;}
for(var face=0;face<numFaces;++face){this.gl.texImage2D(this.getTexImage2DTarget_(face),0,format,width,height,0,format,this.gl.UNSIGNED_BYTE,pixels);}
this.texture_width_=width;this.texture_height_=height;}};o3d.Texture2D=function(opt_width,opt_height){o3d.Texture.call(this);this.width=opt_width||0;this.height=opt_height||0;this.renderSurfaces_=[];};o3d.inherit('Texture2D','Texture');o3d.ParamObject.setUpO3DParam_(o3d.Texture2D,'width','ParamInteger');o3d.ParamObject.setUpO3DParam_(o3d.Texture2D,'height','ParamInteger');o3d.Texture2D.prototype.init_=function(width,height,format,levels,enable_render_surfaces){this.initWithTarget_(this.gl.TEXTURE_2D,width,height,format,levels,enable_render_surfaces);};o3d.Texture2D.prototype.getRenderSurface=function(mip_level){if(!this.renderSurfaces_[mip_level]){var renderSurface=new o3d.RenderSurface();renderSurface.gl=this.gl;renderSurface.initWithTexture(this,mip_level);this.renderSurfaces_[mip_level]=renderSurface;}
return this.renderSurfaces_[mip_level];};o3d.Texture2D.prototype.set=function(level,values){this.setValues_(level,values);};o3d.Texture2D.prototype.setRect=function(level,destination_x,destination_y,source_width,values){var format=this.getGLTextureFormat_();var numChannels=(format==this.gl.RGB?3:4);var source_height=(values.length/numChannels)/source_width;if(destination_x>this.width||destination_y>this.height||destination_x+source_width<0||destination_y+source_height<0){return;}
var size_x=source_width;if(destination_x<0){size_x+=destination_x;}
if(destination_x+source_width>this.width){size_x-=(destination_x+source_width)-this.width;}
var size_y=source_height;if(destination_y<0){size_y+=destination_y;}
if(destination_y+source_height>this.height){size_y-=(destination_y+source_height)-this.height;}
var start_x=(destination_x<0)?Math.abs(destination_x):0;var start_y=(destination_y<0)?Math.abs(destination_y):0;var keptPixels=new Uint8Array(size_x*size_y*numChannels);var count=0;for(var y=0;y<size_y;++y){for(var x=0;x<size_x;++x){var t=(((start_y+y)*source_width)+(start_x+x))*numChannels;keptPixels[count++]=Math.min(255,Math.max(0,values[t]*256.0));keptPixels[count++]=Math.min(255,Math.max(0,values[t+1]*256.0));keptPixels[count++]=Math.min(255,Math.max(0,values[t+2]*256.0));keptPixels[count++]=Math.min(255,Math.max(0,values[t+3]*256.0));}}
var where_x=Math.max(destination_x,0);var where_y=this.height-(Math.max(destination_y,0)+size_y);this.gl.bindTexture(this.texture_target_,this.texture_);this.gl.texSubImage2D(this.gl.TEXTURE_2D,level,where_x,where_y,size_x,size_y,format,this.gl.UNSIGNED_BYTE,keptPixels);};o3d.Texture2D.prototype.getRect=function(level,x,y,width,height){o3d.notImplemented();};o3d.Texture2D.prototype.setFromBitmap=function(bitmap){var resize_to_pot=bitmap.defer_mipmaps_to_texture_;this.setFromCanvas_(bitmap.canvas_,resize_to_pot,bitmap.defer_flip_vertically_to_texture_,bitmap.defer_mipmaps_to_texture_);};o3d.Texture2D.prototype.drawImage=function(source_img,source_mip,source_x,source_y,source_width,source_height,dest_mip,dest_x,dest_y,dest_width,dest_height){this.drawImageFromCanvas_(source_img.canvas_,source_x,source_y,source_width,source_height,dest_mip,dest_x,dest_y,dest_width,dest_height);};o3d.TextureCUBE=function(){o3d.Texture.call(this);this.edgeLength=0;this.faces_set_={0:false,1:false,2:false,3:false,4:false,5:false};};o3d.inherit('TextureCUBE','Texture');o3d.TextureCUBE.CubeFace=goog.typedef;o3d.TextureCUBE.FACE_POSITIVE_X=0;o3d.TextureCUBE.FACE_NEGATIVE_X=1;o3d.TextureCUBE.FACE_POSITIVE_Y=2;o3d.TextureCUBE.FACE_NEGATIVE_Y=3;o3d.TextureCUBE.FACE_POSITIVE_Z=4;o3d.TextureCUBE.FACE_NEGATIVE_Z=5;o3d.ParamObject.setUpO3DParam_(o3d.TextureCUBE,'edgeLength','ParamInteger');o3d.TextureCUBE.prototype.init_=function(edgeLength,format,levels,enable_render_surfaces,debug){this.initWithTarget_(this.gl.TEXTURE_CUBE_MAP,edgeLength,edgeLength,format,levels,enable_render_surfaces,debug);};o3d.TextureCUBE.prototype.getRenderSurface=function(face,mip_level,opt_pack){o3d.notImplemented();};o3d.TextureCUBE.prototype.set=function(face,level,values){this.setValues_(level,values,face);this.faces_set_[face]=true;};o3d.TextureCUBE.prototype.setRect=function(face,level,destination_x,destination_y,source_width,values){o3d.notImplemented();};o3d.TextureCUBE.prototype.getRect=function(face,level,x,y,width,height){o3d.notImplemented();};o3d.TextureCUBE.prototype.setFromBitmap=function(face,bitmap){var generate_mipmaps=bitmap.defer_mipmaps_to_texture_;for(var f in this.faces_set_){generate_mipmaps=generate_mipmaps&&(this.faces_set_[f]||f==face);}
var resize_to_pot=bitmap.defer_mipmaps_to_texture_;this.setFromCanvas_(bitmap.canvas_,resize_to_pot,false,generate_mipmaps,face);this.faces_set_[face]=true;};o3d.TextureCUBE.prototype.drawImage=function(source_img,source_mip,source_x,source_y,source_width,source_height,face,dest_mip,dest_x,dest_y,dest_width,dest_height){this.drawImageFromCanvas_(source_img.canvas_,source_x,source_y,source_width,source_height,dest_mip,dest_x,dest_y,dest_width,dest_height,face);};o3d.Texture.prototype.bindAndSetParameters_=function(addressModeU,addressModeV,minFilter,magFilter){var target=this.texture_target_;this.gl.bindTexture(target,this.texture_);if(!(o3d.Texture.isPowerOfTwo_(this.texture_width_)&&o3d.Texture.isPowerOfTwo_(this.texture_height_))||this.texture_target_==this.gl.TEXTURE_CUBE_MAP){addressModeU=addressModeV=this.gl.CLAMP_TO_EDGE;}
if(this.parameter_cache_.addressModeU!=addressModeU){this.gl.texParameteri(target,this.gl.TEXTURE_WRAP_S,addressModeU);this.parameter_cache_.addressModeU=addressModeU;}
if(this.parameter_cache_.addressModeV!=addressModeV){this.gl.texParameteri(target,this.gl.TEXTURE_WRAP_T,addressModeV);this.parameter_cache_.addressModeV=addressModeV;}
if(this.parameter_cache_.minFilter!=minFilter){this.gl.texParameteri(target,this.gl.TEXTURE_MIN_FILTER,minFilter);this.parameter_cache_.minFilter=minFilter;}
if(this.parameter_cache_.magFilter!=magFilter){this.gl.texParameteri(target,this.gl.TEXTURE_MAG_FILTER,magFilter);this.parameter_cache_.magFilter=magFilter;}};o3d.Bitmap=function(){o3d.ParamObject.call(this);};o3d.inherit('Bitmap','ParamObject');o3d.Bitmap.Semantic=goog.typedef;o3d.Bitmap.FACE_POSITIVE_X=0;o3d.Bitmap.FACE_NEGATIVE_X=1;o3d.Bitmap.FACE_POSITIVE_Y=2;o3d.Bitmap.FACE_NEGATIVE_Y=3;o3d.Bitmap.FACE_POSITIVE_Z=4;o3d.Bitmap.FACE_NEGATIVE_Z=5;o3d.Bitmap.IMAGE=6;o3d.Bitmap.SLICE=7;o3d.Bitmap.scratch_canvas_=null;o3d.Bitmap.getScratchCanvas_=function(){if(!o3d.Bitmap.scratch_canvas_)
o3d.Bitmap.scratch_canvas_=document.createElement('CANVAS');return o3d.Bitmap.scratch_canvas_;}
o3d.Bitmap.prototype.canvas_=null;o3d.Bitmap.prototype.flipVertically=function(){var temp_canvas=document.createElement('CANVAS');temp_canvas.width=this.width;temp_canvas.height=this.height;var context=temp_canvas.getContext('2d');context.translate(0,this.height);context.scale(1,-1);context.drawImage(this.canvas_,0,0,this.width,this.height);this.canvas_=temp_canvas;};o3d.Bitmap.prototype.flipVerticallyLazily_=function(){this.defer_flip_vertically_to_texture_=true;};o3d.Bitmap.prototype.generateMips=function(source_level,num_levels){this.defer_mipmaps_to_texture_=true;};o3d.Bitmap.prototype.width=0;o3d.Bitmap.prototype.height=0;o3d.Bitmap.prototype.defer_mipmaps_to_texture_=false;o3d.Bitmap.prototype.defer_flip_vertically_to_texture_=false;o3d.Bitmap.prototype.format=o3d.Texture.UNKNOWN_FORMAT;o3d.Bitmap.prototype.numMipmaps=1;o3d.Bitmap.prototype.semantic=o3d.Bitmap.UNKNOWN_SEMANTIC;o3d.FileRequest=function(){this.method_="";this.async_=true;this.request_=new XMLHttpRequest();var fileRequest=this;this.request_.onreadystatechange=function(){fileRequest.readyState=this.readyState;fileRequest.done=fileRequest.done||this.done;if(this.readyState==4){if(this.responseText){fileRequest.success=true;}
fileRequest.done=true;}
fileRequest.data=this.responseText;if(fileRequest.onreadystatechange)
fileRequest.onreadystatechange.apply(fileRequest,arguments);}};o3d.inherit('FileRequest','NamedObject');o3d.FileRequest.prototype.onreadystatechange=null;o3d.FileRequest.prototype.uri='';o3d.FileRequest.prototype.data=null;o3d.FileRequest.prototype.readyState=0;o3d.FileRequest.prototype.done=false;o3d.FileRequest.prototype.success=false;o3d.FileRequest.prototype.image_=null;o3d.FileRequest.prototype.error='';o3d.FileRequest.prototype.isImageUrl_=function(url){var extension=url.substring(url.length-4);return(extension=='.png'||extension=='.jpg');};o3d.FileRequest.prototype.imageLoaded_=function(){if(this.image_.complete){this.success=true;this.done=true;this.readyState=4;this.data=new o3d.RawData();this.data.image_=this.image_;}
this.onreadystatechange.apply(this,arguments);};o3d.FileRequest.prototype.open=function(method,uri,async){this.uri=uri;this.method_=method;this.async_=async;};o3d.FileRequest.prototype.send=function(){if(this.isImageUrl_(this.uri)){this.image_=new Image();var that=this;this.image_.onload=function(){that.imageLoaded_.call(that);}
this.image_.src=this.uri;}else{this.request_.open(this.method_,this.uri,this.async_);}};o3d.Renderer={};o3d.Renderer.InitStatus=goog.typedef;o3d.Renderer.UNINITIALIZED=0;o3d.Renderer.SUCCESS=1;o3d.Renderer.GPU_NOT_UP_TO_SPEC=2;o3d.Renderer.OUT_OF_RESOURCES=3;o3d.Renderer.INITIALIZATION_ERROR=4;o3d.Renderer.DisplayMode=goog.typedef;o3d.Renderer.DISPLAY_MODE_DEFAULT=0;o3d.Renderer.render_callback_interval_=null;o3d.Renderer.clients_=[];o3d.Renderer.renderClients=function(){for(var i=0;i<o3d.Renderer.clients_.length;++i){var client=o3d.Renderer.clients_[i];client.counter_manager_.tick();if(client.renderMode==o3d.Client.RENDERMODE_CONTINUOUS){client.render();}}};o3d.Renderer.installRenderInterval=function(){o3d.Renderer.render_callback_interval_=setInterval("o3d.Renderer.renderClients()",1000.0/60.0);};o3d.ClientInfo=function(){o3d.NamedObject.call(this);};o3d.inherit('ClientInfo','NamedObject');o3d.ClientInfo.prototype.num_objects=0;o3d.ClientInfo.prototype.texture_memory_used=0;o3d.ClientInfo.prototype.buffer_memory_used=0;o3d.ClientInfo.prototype.software_renderer=false;o3d.ClientInfo.prototype.non_power_of_two_textures=true;o3d.ClientInfo.prototype.glsl=true;o3d.Client=function(){o3d.NamedObject.call(this);var tempPack=this.createPack();this.root=tempPack.createObject('Transform');this.renderGraphRoot=tempPack.createObject('RenderNode');this.clientId=o3d.Client.nextId++;this.packs_=[tempPack];this.clientInfo=tempPack.createObject('ClientInfo');this.counter_manager_=new o3d.CounterManager;if(o3d.Renderer.clients_.length==0)
o3d.Renderer.installRenderInterval();o3d.Renderer.clients_.push(this);this.stateMapStack_=[];this.stateVariableStacks_={};};o3d.inherit('Client','NamedObject');o3d.Client.RenderCallback=goog.typedef;o3d.Client.TickCallback=goog.typedef;o3d.Client.ErrorCallback=goog.typedef;o3d.Client.prototype.renderGraphRoot=null;o3d.Client.nextId=0;o3d.Client.prototype.then_=0;o3d.Client.prototype.root=null;o3d.Client.prototype.packs_=[];o3d.Client.prototype.counter_manager_=null;o3d.Client.prototype.normalizeClearColorAlpha=true;o3d.Client.prototype.error_callback=function(error_message){alert(error_message);};o3d.Client.prototype.render_callback=function(render_event){};o3d.Client.prototype.tick_callback=function(tick_event){};o3d.Client.prototype.cleanup=function(){this.clearRenderCallback();this.clearTickCallback();this.clearErrorCallback();};o3d.Client.prototype.createPack=function(){var pack=new o3d.Pack;pack.client=this;pack.gl=this.gl;this.packs_.push(pack);return pack;};o3d.Client.prototype.destroyPack=function(pack){o3d.removeFromArray(this.packs_,pack);};o3d.Client.prototype.getObjectById=function(id){o3d.notImplemented();};o3d.Client.prototype.getObjects=function(name,class_name){var objects=[];for(var i=0;i<this.packs_.length;++i){var pack=this.packs_[i];objects=objects.concat(pack.getObjects(name,class_name));}
return objects;};o3d.Client.prototype.getObjectsByClassName=function(class_name){var objects=[];for(var i=0;i<this.packs_.length;++i){var pack=this.packs_[i];objects=objects.concat(pack.getObjectsByClassName(class_name));}
return objects;};o3d.Client.RenderMode=goog.typedef;o3d.Client.RENDERMODE_CONTINUOUS=0;o3d.Client.RENDERMODE_ON_DEMAND=1;o3d.Client.prototype.renderMode=o3d.Client.RENDERMODE_CONTINUOUS;o3d.Client.prototype.render=function(){if(!this.gl){return;}
var render_event=new o3d.RenderEvent;this.counter_manager_.advanceRenderFrameCounters();this.clearStateStack_();var now=(new Date()).getTime()*0.001;if(this.then_==0.0)
render_event.elapsedTime=0.0;else
render_event.elapsedTime=now-this.then_;if(this.render_callback){for(var stat in this.render_stats_){render_event[stat]=this.render_stats_[stat];}
this.render_callback(render_event);}
this.then_=now;this.gl.colorMask(true,true,true,true);this.renderTree(this.renderGraphRoot);if(this.normalizeClearColorAlpha){this.gl.colorMask(false,false,false,true);this.gl.clearColor(0.0,0.0,0.0,1.0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);}};o3d.Client.prototype.render_stats={}
o3d.Client.prototype.renderTree=function(render_node){this.render_stats_={drawElementsCulled:0,drawElementsProcessed:0,drawElementsRendered:0,primitivesRendered:0,transformsCulled:0,transformsProcessed:0};render_node.render();};o3d.Client.prototype.getDisplayModes=[];o3d.Client.prototype.setFullscreenClickRegion=function(x,y,width,height,mode_id){o3d.notImplemented();};o3d.Client.prototype.clearFullscreenClickRegion=function(){o3d.notImplemented();};o3d.Client.prototype.cancelFullscreenDisplay=function(){render_node.render();};o3d.Client.prototype.client_info=null;o3d.Client.prototype.fullscreen=false;o3d.Client.prototype.__defineGetter__('width',function(){return this.gl.hack_canvas.width;});o3d.Client.prototype.__defineSetter__('width',function(x){this.gl.hack_canvas.width=x;});o3d.Client.prototype.__defineGetter__('height',function(){return this.gl.hack_canvas.height;});o3d.Client.prototype.__defineSetter__('height',function(x){this.gl.hack_canvas.height=x;});o3d.Client.prototype.initWithCanvas=function(canvas){var gl;var standard_attributes={alpha:true,depth:true,stencil:true,antialias:true,premultipliedAlpha:true};if(!canvas||!canvas.getContext){return false;}
var names=["webgl","experimental-webgl","moz-webgl"];for(var ii=0;ii<names.length;++ii){try{gl=canvas.getContext(names[ii],standard_attributes)}catch(e){}
if(gl){break;}}
if(!gl){return false;}
gl.hack_canvas=canvas;this.gl=gl;this.root.gl=gl;this.renderGraphRoot.gl=gl;gl.client=this;gl.displayInfo={width:canvas.width,height:canvas.height};o3d.State.createDefaultState_(gl).push_();this.initErrorTextures_();return true;}
o3d.Client.prototype.initErrorTextures_=function(){var r=[1,0,0,1];var Y=[1,1,0,1];var error=[r,r,r,r,r,r,r,r,r,r,Y,Y,Y,Y,r,r,r,Y,r,r,r,Y,Y,r,r,Y,r,r,Y,r,Y,r,r,Y,r,Y,r,r,Y,r,r,Y,Y,r,r,r,Y,r,r,r,Y,Y,Y,Y,r,r,r,r,r,r,r,r,r,r];var pixels=[];for(var i=0;i<error.length;i++){for(var j=0;j<4;j++){pixels[i*4+j]=error[i][j];}}
var defaultTextureCube=new o3d.TextureCUBE();defaultTextureCube.gl=this.gl;defaultTextureCube.init_(8,o3d.Texture.ARGB8,1,false,true);for(var i=0;i<6;++i){defaultTextureCube.set(i,0,pixels);}
defaultTextureCube.name='DefaultTextureCube';this.error_texture_cube_=defaultTextureCube;this.fallback_error_texture_cube_=defaultTextureCube;var defaultTexture=new o3d.Texture2D();defaultTexture.gl=this.gl;defaultTexture.init_(8,8,o3d.Texture.ARGB8,1,false);defaultTexture.set(0,pixels);defaultTexture.name='DefaultTexture';this.error_texture_=defaultTexture;this.fallback_error_texture_=defaultTexture;};o3d.Client.prototype.setRenderCallback=function(render_callback){if(this.render_callback){this.clearRenderCallback();}
this.render_callback=render_callback;};o3d.Client.prototype.clearRenderCallback=function(){clearInterval(this.render_callback_interval_);this.render_callback=null;};o3d.Client.prototype.setPostRenderCallback=function(post_render_callback){this.postRenderCallback=post_render_callback;};o3d.Client.prototype.clearPostRenderCallback=function(){this.postRenderCallback=null;};o3d.Client.prototype.setLostResourcesCallback=function(lost_resources_callback){this.lostResourcesCallback=lost_resources_callback;};o3d.Client.prototype.clearLostResourcesCallback=function(){this.lostResourcesCallback=null;};o3d.Client.getEvent_=function(event){return event?event:window.event;};o3d.Client.getEventInfo_=function(event){var elem=event.target?event.target:event.srcElement;var name=elem.id?elem.id:('->'+elem.toString());var wheel=event.detail?event.detail:-event.wheelDelta;return{event:event,element:elem,name:name,wheel:wheel};};o3d.Client.getAbsolutePosition_=function(element){var r={x:0,y:0};for(var e=element;e;e=e.offsetParent){r.x+=e.offsetLeft;r.y+=e.offsetTop;}
return r;};o3d.Client.getLocalXY_=function(eventInfo){var event=eventInfo.event;var p=o3d.Client.getAbsolutePosition_(eventInfo.element);return{x:event.pageX-p.x,y:event.pageY-p.y};};o3d.Client.wrapEventCallback_=function(handler,doCancelEvent){return function(event){event=o3d.Client.getEvent_(event);var originalEvent=event;var info=o3d.Client.getEventInfo_(event);var relativeCoords=o3d.Client.getLocalXY_(info);event=o3d.clone(event);event.x=relativeCoords.x;event.y=relativeCoords.y;event.deltaY=-info.wheel;handler(event);if(doCancelEvent){o3djs.event.cancel(originalEvent);}};};o3d.Client.prototype.setEventCallback=function(type,handler){var listener=this.gl.hack_canvas;var isWheelEvent=type=='wheel';var forKeyEvent=type.substr(0,3)=='key';if(forKeyEvent){listener=document;}else{handler=o3d.Client.wrapEventCallback_(handler,isWheelEvent);}
if(isWheelEvent){listener.addEventListener('DOMMouseScroll',handler,true);listener.addEventListener('mousewheel',handler,true);}else{listener.addEventListener(type,handler,true);}};o3d.Client.prototype.clearEventCallback=function(type){var listener=this.gl.hack_canvas;var isWheelEvent=type=='wheel';var forKeyEvent=type.substr(0,3)=='key';if(forKeyEvent){listener=document;}
if(isWheelEvent){listener.removeEventListener('DOMMouseScroll');listener.removeEventListener('mousewheel');}else{listener.removeEventListener(type);}};o3d.Client.prototype.setErrorTexture=function(texture){this.error_texture_=texture;};o3d.Client.prototype.setErrorTextureCube=function(texture){this.error_texture_cube_map_=texture;};o3d.Client.prototype.setTickCallback=function(tick_callback){this.tickCallback=tick_callback;};o3d.Client.prototype.clearTickCallback=function(){this.tickCallback=null;};o3d.Client.prototype.setErrorCallback=function(error_callback){if(error_callback){this.error_callback=this.wrapErrorCallback_(error_callback);}else{this.error_callback=function(string){this.last_error_=string;};}};o3d.Client.prototype.wrapErrorCallback_=function(error_callback){return function(string){this.last_error_=string;error_callback(string);}}
o3d.Client.prototype.clearErrorCallback=function(){this.setErrorCallback(null);};o3d.Client.prototype.invalidateAllParameters=function(){o3d.notImplemented();};o3d.Client.prototype.toDataURL=function(opt_mime_type){o3d.notImplemented();};o3d.Client.prototype.clearStateStack_=function(){this.stateMapStack_=[];for(var name in this.stateVariableStacks_){var l=this.stateVariableStacks_[name];if(l.length!=1){this.stateVariableStacks_[name]=l.slice(0,1);}}};o3d.Client.prototype.pushState_=function(variable_map){this.stateMapStack_.push(variable_map);for(var name in variable_map){var value=variable_map[name];if(this.stateVariableStacks_[name]==undefined){this.stateVariableStacks_[name]=[];}
this.stateVariableStacks_[name].push(value);}
o3d.State.setVariables_(this.gl,variable_map);};o3d.Client.prototype.popState_=function(){var variable_map=this.stateMapStack_.pop();for(var name in variable_map){var stack=this.stateVariableStacks_[name];stack.pop();variable_map[name]=stack.length?stack[stack.length-1]:o3d.State.stateVariableInfos_[name]['defaultValue'];}
o3d.State.setVariables_(this.gl,variable_map);};o3d.Client.prototype.getState_=function(name){var stack=this.stateVariableStacks_[name];return stack.length?stack[stack.length-1]:o3d.State.stateVariableInfos_[name]['defaultValue'];};o3d.Client.prototype.renderer_init_status=0;o3d.Client.prototype.cursor=null;o3d.Client.prototype.error_texture_=null;o3d.Client.prototype.error_texture_cube_=null;o3d.Client.prototype.fallback_error_texture_=null;o3d.Client.prototype.fallback_error_texture_cube_=null;o3d.Client.prototype.last_error_='';o3d.Client.prototype.__defineGetter__('lastError',function(){return this.last_error_;});o3d.Client.prototype.reportErrors_=function(){return(this.error_texture_==null);}
o3d.Client.prototype.objects=[];o3d.Client.prototype.clearLastError=function(){this.last_error_='';};o3d.Client.prototype.profileReset=function(){o3d.notImplemented();};o3d.Client.prototype.profileToString=function(){o3d.notImplemented();};o3d.Client.prototype.clientId=0;o3d.Client.prototype.clientInfo=null;o3d.Client.prototype.canvas=null;o3d.RenderNode=function(opt_priority,opt_active){o3d.ParamObject.call(this);this.priority=opt_priority||0;this.children=[];this.active=opt_active||true;this.parent=null;};o3d.inherit('RenderNode','ParamObject');o3d.ParamObject.setUpO3DParam_(o3d.RenderNode,'priority','ParamFloat');o3d.ParamObject.setUpO3DParam_(o3d.RenderNode,'active','ParamBoolean');o3d.RenderNode.prototype.__defineSetter__('parent',function(p){if(this.parent_){this.parent_.removeChild(this);}
this.parent_=p;if(this.parent_){if(!this.parent_.addChild){throw('Parent of render node must be render node or null.');}
this.parent_.addChild(this);}});o3d.RenderNode.prototype.__defineGetter__('parent',function(p){return this.parent_;});o3d.RenderNode.prototype.addChild=function(child){this.children.push(child);};o3d.RenderNode.prototype.removeChild=function(child){o3d.removeFromArray(this.children,child);};o3d.RenderNode.prototype.getRenderNodesInTree=function(){o3d.notImplemented();};o3d.RenderNode.prototype.getRenderNodesByNameInTree=function(name){o3d.notImplemented();};o3d.RenderNode.prototype.getRenderNodesByClassNameInTree=function(class_name){o3d.notImplemented();};o3d.RenderNode.prototype.render=function(){function compare(a,b){return a.priority-b.priority;}
this.children.sort(compare);var children=this.children;this.before();for(var i=0;i<children.length;++i){children[i].render();}
this.after();};o3d.RenderNode.prototype.before=function(){};o3d.RenderNode.prototype.after=function(){};o3d.ClearBuffer=function(){o3d.RenderNode.call(this);this.clearColor=[0,0,0,1];this.clearColorFlag=true;this.clearDepth=1;this.clearDepthFlag=true;this.clearStencil=0;this.clearStencilFlag=true;};o3d.inherit('ClearBuffer','RenderNode');o3d.ParamObject.setUpO3DParam_(o3d.ClearBuffer,'clearColor','ParamFloat4');o3d.ParamObject.setUpO3DParam_(o3d.ClearBuffer,'clearColorFlag','ParamBoolean');o3d.ParamObject.setUpO3DParam_(o3d.ClearBuffer,'clearDepth','ParamFloat');o3d.ParamObject.setUpO3DParam_(o3d.ClearBuffer,'clearDepthFlag','ParamBoolean');o3d.ParamObject.setUpO3DParam_(o3d.ClearBuffer,'clearStencil','ParamInteger');o3d.ParamObject.setUpO3DParam_(o3d.ClearBuffer,'clearStencilFlag','ParamBoolean');o3d.ClearBuffer.prototype.before=function(){var flags=0;this.gl.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]);this.gl.clearDepth(this.clearDepth);this.gl.clearStencil(this.clearStencil);if(this.clearColorFlag)
flags=flags|this.gl.COLOR_BUFFER_BIT;if(this.clearDepthFlag)
flags=flags|this.gl.DEPTH_BUFFER_BIT;if(this.clearStencilFlag)
flags=flags|this.gl.STENCIL_BUFFER_BIT;this.gl.clear(flags);};o3d.StateSet=function(opt_state){o3d.RenderNode.call(this);this.state=opt_state||null;};o3d.inherit('StateSet','RenderNode');o3d.ParamObject.setUpO3DParam_(o3d.StateSet,'state','ParamState');o3d.StateSet.prototype.before=function(){if(this.state){this.state.push_();}};o3d.StateSet.prototype.after=function(){if(this.state){this.state.pop_();}};o3d.Viewport=function(opt_viewport,opt_depthRange){o3d.RenderNode.call(this);this.viewport=opt_viewport||[0.0,0.0,1.0,1.0];this.depthRange=opt_depthRange||[0.0,1.0];};o3d.inherit('Viewport','RenderNode');o3d.ParamObject.setUpO3DParam_(o3d.Viewport,'viewport','ParamFloat4');o3d.ParamObject.setUpO3DParam_(o3d.Viewport,'depthRange','ParamFloat2');o3d.Viewport.prototype.before=function(){var x=this.viewport[0]*this.gl.displayInfo.width;var y=(1-this.viewport[1]-this.viewport[3])*this.gl.displayInfo.height;var width=this.viewport[2]*this.gl.displayInfo.width;var height=this.viewport[3]*this.gl.displayInfo.height;this.gl.viewport(x,y,width,height);if(x!=0||y!=0||this.viewport[2]!=1||this.viewport[3]!=1){this.gl.enable(this.gl.SCISSOR_TEST);this.gl.scissor(x,y,width,height);}else{this.gl.disable(this.gl.SCISSOR_TEST);}};o3d.TreeTraversal=function(opt_transform){o3d.RenderNode.call(this);this.transform=opt_transform||null;this.drawLists_=[];this.drawListsToReset_=[];};o3d.inherit('TreeTraversal','RenderNode');o3d.ParamObject.setUpO3DParam_(o3d.TreeTraversal,'transform','ParamTransform');o3d.TreeTraversal.prototype.registerDrawList=function(draw_list,draw_context,reset){if(reset==undefined||reset){this.drawListsToReset_.push(draw_list);}
this.drawLists_.push({list:draw_list,context:draw_context});};o3d.TreeTraversal.prototype.unregisterDrawList=function(draw_list){o3d.notImplemented();};o3d.TreeTraversal.prototype.before=function(){for(var i=0;i<this.drawListsToReset_.length;++i){this.drawListsToReset_[i].list_=[];}
this.transform.traverse(this.drawLists_);};o3d.DrawList=function(){o3d.NamedObject.call(this);this.list_=[];};o3d.inherit('DrawList','NamedObject');this.list_=[];o3d.DrawList.SortMethod=goog.typedef;o3d.DrawList.BY_PERFORMANCE=0;o3d.DrawList.BY_Z_ORDER=1;o3d.DrawList.BY_PRIORITY=2;o3d.DrawList.comparePriority_=function(drawElementInfoA,drawElementInfoB){return drawElementInfoA.drawElement.owner.priority-
drawElementInfoB.drawElement.owner.priority;};o3d.DrawList.compareZ_=function(drawElementInfoA,drawElementInfoB){return o3d.Transform.transformPointZOnly(drawElementInfoB.worldViewProjection,drawElementInfoB.drawElement.owner.zSortPoint)-
o3d.Transform.transformPointZOnly(drawElementInfoA.worldViewProjection,drawElementInfoA.drawElement.owner.zSortPoint);};o3d.DrawList.prototype.sort_=function(sort_method){switch(sort_method){case o3d.DrawList.BY_PRIORITY:this.list_.sort(o3d.DrawList.comparePriority_);break;case o3d.DrawList.BY_Z_ORDER:this.list_.sort(o3d.DrawList.compareZ_);break;case o3d.DrawList.BY_PERFORMANCE:default:break;}};o3d.DrawList.prototype.render=function(){for(var i=0;i<this.list_.length;++i){var drawElementInfo=this.list_[i];var world=drawElementInfo.world;var view=drawElementInfo.view;var viewProjection=drawElementInfo.viewProjection;var worldViewProjection=drawElementInfo.worldViewProjection;var projection=drawElementInfo.projection;var transform=drawElementInfo.transform;var drawElement=drawElementInfo.drawElement;var element=drawElement.owner;var material=drawElement.material||element.material;var effect=material.effect;o3d.Param.SAS.setWorld(world);o3d.Param.SAS.setView(view);o3d.Param.SAS.setProjection(projection);o3d.Param.SAS.setViewProjection(viewProjection);o3d.Param.SAS.setWorldViewProjection(worldViewProjection);var paramObjects=[transform,drawElement,element];if(element.streamBank){paramObjects.push(element.streamBank);}
paramObjects.push(material,effect,o3d.Param.SAS);effect.searchForParams_(paramObjects);var state_on=(material.state!=undefined);if(state_on){material.state.push_();}
element.render();if(state_on){material.state.pop_();}}};o3d.DrawPass=function(opt_drawList,opt_sortMethod){o3d.RenderNode.call(this);this.drawList=opt_drawList||null;this.sortMethod=opt_sortMethod||o3d.DrawList.BY_PERFORMANCE;};o3d.inherit('DrawPass','RenderNode');o3d.DrawPass.SortMethod=goog.typedef;o3d.ParamObject.setUpO3DParam_(o3d.DrawPass,'drawList','ParamDrawList');o3d.ParamObject.setUpO3DParam_(o3d.DrawPass,'sortMethod','ParamInteger');o3d.DrawPass.prototype.before=function(){if(this.drawList){this.drawList.sort_(this.sortMethod);this.drawList.render();}};